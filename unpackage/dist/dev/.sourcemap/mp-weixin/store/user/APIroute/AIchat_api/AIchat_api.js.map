{"version":3,"file":"AIchat_api.js","sources":["store/user/APIroute/AIchat_api/AIchat_api.js"],"sourcesContent":["/**\n * AI聊天API接口\n * @module store/user/APIroute/AIchat_api\n */\nimport {\n    AIQA_QUESTION_URL,\n    AIQA_GET_HISTORY_URL,\n    AIQA_DELETE_HISTORY_URL,\n    AIQA_GET_HISTORY_DETAIL_URL\n} from '../../API.js';\nimport store from '../../../index.js';\n\n/**\n * 封装uni.request为Promise形式\n * @param {Object} options - 请求配置\n * @returns {Promise<Object>} - 返回请求结果的Promise\n */\nconst uniRequest = (options) => {\n    return new Promise((resolve, reject) => {\n        uni.request({\n            url: options.url,\n            data: options.data || options.params,\n            method: options.method || 'GET',\n            header: options.header || {},\n            success: (res) => {\n                resolve(res);\n            },\n            fail: (err) => {\n                reject(err);\n            }\n        });\n    });\n};\n\n/**\n * 发送消息给AI并获取回复\n * @param {Object} messageData - 消息数据\n * @param {string} messageData.content - 用户输入的消息内容\n * @param {string} messageData.chatMode - 聊天模式: 'general'(通用) | 'school'(择校) | 'career'(职业规划)\n * @param {string|null} messageData.conversationId - 对话ID，若为新对话则为null\n * @returns {Promise<Object>} - 返回AI回复的内容和对话ID\n */\nexport const sendMessageToAI = async (messageData) => {\n    try {\n        // 获取用户ID\n        const userId = store.state.user.baseInfo.id;\n        // 获取用户学校和专业信息\n        const userSchool = store.state.user.baseInfo.userInfo.school;\n        const userMajor = store.state.user.baseInfo.userInfo.major;\n        \n        // 构建请求数据\n        const requestData = {\n            userId: userId,\n            content: messageData.content,\n            chatMode: messageData.chatMode,\n            school: userSchool,\n            major: userMajor,\n            conversationId: messageData.conversationId\n        };\n        \n        // 发送请求\n        const response = await uniRequest({\n            url: AIQA_QUESTION_URL,\n            method: 'POST',\n            data: requestData\n        });\n        \n        // 检查请求是否成功\n        if (response.data && response.data.code === 200) {\n            return {\n                success: true,\n                conversationId: response.data.data.conversationId,\n                aiResponse: response.data.data.aiResponse,\n                messageId: response.data.data.messageId\n            };\n        } else {\n            console.error('AI回复失败:', response.data.message || '未知错误');\n            return {\n                success: false,\n                message: response.data.message || '获取AI回复失败'\n            };\n        }\n    } catch (error) {\n        console.error('发送消息给AI时出错:', error);\n        return {\n            success: false,\n            message: '网络错误，请稍后重试'\n        };\n    }\n};\n\n/**\n * 获取用户的所有对话历史摘要\n * @returns {Promise<Object>} - 返回对话历史列表\n */\nexport const getConversationHistory = async () => {\n    try {\n        // 获取用户ID\n        const userId = store.state.user.baseInfo.id;\n        \n        // 发送请求\n        const response = await uniRequest({\n            url: AIQA_GET_HISTORY_URL,\n            method: 'GET',\n            data: { userId }\n        });\n        \n        // 检查请求是否成功\n        if (response.data && response.data.code === 200) {\n            return {\n                success: true,\n                conversations: response.data.data.conversations\n            };\n        } else {\n            console.error('获取对话历史失败:', response.data.message || '未知错误');\n            return {\n                success: false,\n                message: response.data.message || '获取对话历史失败'\n            };\n        }\n    } catch (error) {\n        console.error('获取对话历史时出错:', error);\n        return {\n            success: false,\n            message: '网络错误，请稍后重试'\n        };\n    }\n};\n\n/**\n * 获取特定对话的详细内容\n * @param {string} conversationId - 对话ID\n * @returns {Promise<Object>} - 返回对话详细内容\n */\nexport const getConversationDetail = async (conversationId) => {\n    try {\n        // 获取用户ID\n        const userId = store.state.user.baseInfo.id;\n        \n        // 发送请求\n        const response = await uniRequest({\n            url: AIQA_GET_HISTORY_DETAIL_URL,\n            method: 'GET',\n            data: { \n                userId,\n                conversationId \n            }\n        });\n        \n        // 检查请求是否成功\n        if (response.data && response.data.code === 200) {\n            return {\n                success: true,\n                messages: response.data.data.messages\n            };\n        } else {\n            console.error('获取对话详情失败:', response.data.message || '未知错误');\n            return {\n                success: false,\n                message: response.data.message || '获取对话详情失败'\n            };\n        }\n    } catch (error) {\n        console.error('获取对话详情时出错:', error);\n        return {\n            success: false,\n            message: '网络错误，请稍后重试'\n        };\n    }\n};\n\n/**\n * 删除特定对话\n * @param {string} conversationId - 对话ID\n * @returns {Promise<Object>} - 返回删除结果\n */\nexport const deleteConversation = async (conversationId) => {\n    try {\n        // 获取用户ID\n        const userId = store.state.user.baseInfo.id;\n        \n        // 发送请求\n        const response = await uniRequest({\n            url: AIQA_DELETE_HISTORY_URL,\n            method: 'POST',\n            data: {\n                userId,\n                conversationId\n            }\n        });\n        \n        // 检查请求是否成功\n        if (response.data && response.data.code === 200) {\n            return {\n                success: true,\n                message: '对话已成功删除'\n            };\n        } else {\n            console.error('删除对话失败:', response.data.message || '未知错误');\n            return {\n                success: false,\n                message: response.data.message || '删除对话失败'\n            };\n        }\n    } catch (error) {\n        console.error('删除对话时出错:', error);\n        return {\n            success: false,\n            message: '网络错误，请稍后重试'\n        };\n    }\n}; "],"names":["uni","store","AIQA_QUESTION_URL","AIQA_GET_HISTORY_URL","AIQA_GET_HISTORY_DETAIL_URL","AIQA_DELETE_HISTORY_URL"],"mappings":";;;;AAiBA,MAAM,aAAa,CAAC,YAAY;AAC5B,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpCA,kBAAAA,MAAI,QAAQ;AAAA,MACR,KAAK,QAAQ;AAAA,MACb,MAAM,QAAQ,QAAQ,QAAQ;AAAA,MAC9B,QAAQ,QAAQ,UAAU;AAAA,MAC1B,QAAQ,QAAQ,UAAU,CAAE;AAAA,MAC5B,SAAS,CAAC,QAAQ;AACd,gBAAQ,GAAG;AAAA,MACd;AAAA,MACD,MAAM,CAAC,QAAQ;AACX,eAAO,GAAG;AAAA,MACb;AAAA,IACb,CAAS;AAAA,EACT,CAAK;AACL;AAUY,MAAC,kBAAkB,OAAO,gBAAgB;AAClD,MAAI;AAEA,UAAM,SAASC,YAAAA,MAAM,MAAM,KAAK,SAAS;AAEzC,UAAM,aAAaA,YAAAA,MAAM,MAAM,KAAK,SAAS,SAAS;AACtD,UAAM,YAAYA,YAAAA,MAAM,MAAM,KAAK,SAAS,SAAS;AAGrD,UAAM,cAAc;AAAA,MAChB;AAAA,MACA,SAAS,YAAY;AAAA,MACrB,UAAU,YAAY;AAAA,MACtB,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,gBAAgB,YAAY;AAAA,IACxC;AAGQ,UAAM,WAAW,MAAM,WAAW;AAAA,MAC9B,KAAKC,eAAiB;AAAA,MACtB,QAAQ;AAAA,MACR,MAAM;AAAA,IAClB,CAAS;AAGD,QAAI,SAAS,QAAQ,SAAS,KAAK,SAAS,KAAK;AAC7C,aAAO;AAAA,QACH,SAAS;AAAA,QACT,gBAAgB,SAAS,KAAK,KAAK;AAAA,QACnC,YAAY,SAAS,KAAK,KAAK;AAAA,QAC/B,WAAW,SAAS,KAAK,KAAK;AAAA,MAC9C;AAAA,IACA,OAAe;AACHF,0BAAA,MAAA,SAAA,sDAAc,WAAW,SAAS,KAAK,WAAW,MAAM;AACxD,aAAO;AAAA,QACH,SAAS;AAAA,QACT,SAAS,SAAS,KAAK,WAAW;AAAA,MAClD;AAAA,IACS;AAAA,EACJ,SAAQ,OAAO;AACZA,kBAAA,MAAA,MAAA,SAAA,sDAAc,eAAe,KAAK;AAClC,WAAO;AAAA,MACH,SAAS;AAAA,MACT,SAAS;AAAA,IACrB;AAAA,EACK;AACL;AAMY,MAAC,yBAAyB,YAAY;AAC9C,MAAI;AAEA,UAAM,SAASC,YAAAA,MAAM,MAAM,KAAK,SAAS;AAGzC,UAAM,WAAW,MAAM,WAAW;AAAA,MAC9B,KAAKE,eAAoB;AAAA,MACzB,QAAQ;AAAA,MACR,MAAM,EAAE,OAAQ;AAAA,IAC5B,CAAS;AAGD,QAAI,SAAS,QAAQ,SAAS,KAAK,SAAS,KAAK;AAC7C,aAAO;AAAA,QACH,SAAS;AAAA,QACT,eAAe,SAAS,KAAK,KAAK;AAAA,MAClD;AAAA,IACA,OAAe;AACHH,0BAAc,MAAA,SAAA,uDAAA,aAAa,SAAS,KAAK,WAAW,MAAM;AAC1D,aAAO;AAAA,QACH,SAAS;AAAA,QACT,SAAS,SAAS,KAAK,WAAW;AAAA,MAClD;AAAA,IACS;AAAA,EACJ,SAAQ,OAAO;AACZA,kBAAA,MAAA,MAAA,SAAA,uDAAc,cAAc,KAAK;AACjC,WAAO;AAAA,MACH,SAAS;AAAA,MACT,SAAS;AAAA,IACrB;AAAA,EACK;AACL;AAOY,MAAC,wBAAwB,OAAO,mBAAmB;AAC3D,MAAI;AAEA,UAAM,SAASC,YAAAA,MAAM,MAAM,KAAK,SAAS;AAGzC,UAAM,WAAW,MAAM,WAAW;AAAA,MAC9B,KAAKG,eAA2B;AAAA,MAChC,QAAQ;AAAA,MACR,MAAM;AAAA,QACF;AAAA,QACA;AAAA,MACH;AAAA,IACb,CAAS;AAGD,QAAI,SAAS,QAAQ,SAAS,KAAK,SAAS,KAAK;AAC7C,aAAO;AAAA,QACH,SAAS;AAAA,QACT,UAAU,SAAS,KAAK,KAAK;AAAA,MAC7C;AAAA,IACA,OAAe;AACHJ,0BAAc,MAAA,SAAA,uDAAA,aAAa,SAAS,KAAK,WAAW,MAAM;AAC1D,aAAO;AAAA,QACH,SAAS;AAAA,QACT,SAAS,SAAS,KAAK,WAAW;AAAA,MAClD;AAAA,IACS;AAAA,EACJ,SAAQ,OAAO;AACZA,kBAAA,MAAA,MAAA,SAAA,uDAAc,cAAc,KAAK;AACjC,WAAO;AAAA,MACH,SAAS;AAAA,MACT,SAAS;AAAA,IACrB;AAAA,EACK;AACL;AAOY,MAAC,qBAAqB,OAAO,mBAAmB;AACxD,MAAI;AAEA,UAAM,SAASC,YAAAA,MAAM,MAAM,KAAK,SAAS;AAGzC,UAAM,WAAW,MAAM,WAAW;AAAA,MAC9B,KAAKI,eAAuB;AAAA,MAC5B,QAAQ;AAAA,MACR,MAAM;AAAA,QACF;AAAA,QACA;AAAA,MACH;AAAA,IACb,CAAS;AAGD,QAAI,SAAS,QAAQ,SAAS,KAAK,SAAS,KAAK;AAC7C,aAAO;AAAA,QACH,SAAS;AAAA,QACT,SAAS;AAAA,MACzB;AAAA,IACA,OAAe;AACHL,0BAAA,MAAA,SAAA,uDAAc,WAAW,SAAS,KAAK,WAAW,MAAM;AACxD,aAAO;AAAA,QACH,SAAS;AAAA,QACT,SAAS,SAAS,KAAK,WAAW;AAAA,MAClD;AAAA,IACS;AAAA,EACJ,SAAQ,OAAO;AACZA,kBAAc,MAAA,MAAA,SAAA,uDAAA,YAAY,KAAK;AAC/B,WAAO;AAAA,MACH,SAAS;AAAA,MACT,SAAS;AAAA,IACrB;AAAA,EACK;AACL;;;;;"}