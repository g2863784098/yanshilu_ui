{"version":3,"file":"c-lottie.js","sources":["uni_modules/c-lottie/components/c-lottie/c-lottie.vue","/Users/ghw/Documents/waibao/yanshilu_ui/uni_modules/c-lottie/components/c-lottie/c-lottie.vue?type=component"],"sourcesContent":["<template>\n\n\n\n\n\n\n\n\t<view class=\"c-lottie\" :style=\"{width,height}\">\n\t\t<canvas class=\"canvas\" :id=\"myCanvasId\" type=\"2d\"></canvas>\n\t</view>\n\n</template>\n<script lang=\"uts\">\n\t/**\n\t * c-lottie Lottie组件\n\t * @property {String} canvasId 画布id\n\t * @property {String} width 图像宽度 默认750rpx 单位rpx/px\n\t * @property {String} height 图像高度 默认750rpx 单位rpx/px\n\t * @property {String} src Lottie文件地址 小程序只支持网络地址\n\t * @property {String} data Lottie文件data\n\t * @property {Boolean} autoPlay 是否自动播放 默认true\n\t * @property {Boolean} loop 是否循环播放 默认值为 true\n\t * @property {String} renderer 渲染模式 默认值为canvas 可选值 svg|canvas 小程序不支持\n\t * @property {Boolean} isOnChange 是否开启播放进度监听 默认false false时不触发EnterFrame\n\t * @event {Function()} Complete 监听动画播放完成\n\t * @event {Function()} LoopComplete 监听当前循环播放完成\n\t * @event {Function()} EnterFrame 监听动画播放进度\n\t * @event {Function()} SegmentStart 监听开始播放一个动画片段\n\t * @event {Function()} dataReady 当动画的所有部分都已加载时触发\n\t * @event {Function()} dataFailed 当部分动画无法加载时触发\n\t * 组件内方法统一使用 call(funName, args) 调用player实例方法 详见文档\n\t * */\n\timport uuid from './js/uuid.js'\n\n\timport lottie from 'lottie-miniprogram'\n\n\n\n\n\texport default {\n\t\tprops: {\n\t\t\tcanvasId: {\n\t\t\t\ttype: String\n\t\t\t},\n\t\t\twidth: {\n\t\t\t\ttype: String,\n\t\t\t\tdefault: '750rpx'\n\t\t\t},\n\t\t\theight: {\n\t\t\t\ttype: String,\n\t\t\t\tdefault: '750rpx'\n\t\t\t},\n\t\t\tsrc: {\n\t\t\t\ttype: String,\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\ttype: String,\n\t\t\t},\n\t\t\tautoPlay: { //是否自动播放\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: true\n\t\t\t},\n\t\t\tloop: { //是否循环播放 默认值为 true\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: true\n\t\t\t},\n\t\t\trenderer: { //渲染模式 默认值为canvas 可选值 svg\n\t\t\t\ttype: String,\n\t\t\t\tdefault: 'canvas',\n\t\t\t},\n\t\t\tisOnChange: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: false\n\t\t\t}\n\t\t},\n\t\temits: ['Complete', 'LoopComplete', 'EnterFrame', 'SegmentStart','dataReady','dataFailed'],\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tfun: {}\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\tmyCanvasId() {\n\t\t\t\tif (!this.canvasId) {\n\t\t\t\t\treturn 'c' + uuid(18)\n\t\t\t\t} else {\n\t\t\t\t\treturn this.canvasId\n\t\t\t\t}\n\t\t\t},\n\t\t\tlottieData() {\n\t\t\t\treturn {\n\t\t\t\t\tmyCanvasId: this.myCanvasId,\n\t\t\t\t\twidth: this.width,\n\t\t\t\t\theight: this.height,\n\t\t\t\t\tsrc: this.src,\n\t\t\t\t\tdata: this.data,\n\t\t\t\t\tautoPlay: this.autoPlay,\n\t\t\t\t\tloop: this.loop,\n\t\t\t\t\trenderer: this.renderer,\n\t\t\t\t\tisOnChange: this.isOnChange\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\twatch: {\n\t\t\tlottieData() {\n\n\t\t\t\tthis.render()\n\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tcall(name, args) {\n\t\t\t\tthis.fun = {name,args}\n\n\t\t\t\tthis.callPlayer(this.fun)\n\n\t\t\t},\n\n\t\t\tgetContext() {\n\t\t\t\treturn new Promise((resolve) => {\n\t\t\t\t\tconst {\n\t\t\t\t\t\tpixelRatio\n\t\t\t\t\t} = uni.getWindowInfo()\n\t\t\t\t\tuni.createSelectorQuery()\n\t\t\t\t\t\t.in(this)\n\t\t\t\t\t\t.select(`#${this.myCanvasId}`)\n\t\t\t\t\t\t.fields({\n\t\t\t\t\t\t\tnode: true,\n\t\t\t\t\t\t\tsize: true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.exec(res => {\n\t\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\t\twidth,\n\t\t\t\t\t\t\t\theight\n\t\t\t\t\t\t\t} = res[0]\n\t\t\t\t\t\t\tconst canvas = res[0].node\n\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\tcanvas,\n\t\t\t\t\t\t\t\twidth,\n\t\t\t\t\t\t\t\theight,\n\t\t\t\t\t\t\t\tpixelRatio\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t},\n\t\t\tasync render() {\n\t\t\t\tif (this.player) {\n\t\t\t\t\t// uni.__f__('log','at uni_modules/c-lottie/components/c-lottie/c-lottie.vue:149',player);\n\t\t\t\t\t// call('stop')\n\t\t\t\t\tthis.call('destroy', this.player)\n\t\t\t\t}\n\t\t\t\tlet {\n\t\t\t\t\tcanvas,\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t\tpixelRatio\n\t\t\t\t} = await this.getContext()\n\t\t\t\tthis.myCanvas = canvas\n\t\t\t\tthis.context = canvas.getContext('2d')\n\t\t\t\t//避免出现锯齿问题\n\t\t\t\tthis.context.scale(pixelRatio, pixelRatio)\n\t\t\t\tcanvas.width = width * pixelRatio\n\t\t\t\tcanvas.height = height * pixelRatio\n\t\t\t\tlottie.setup(this.myCanvas)\n\t\t\t\tthis.player = lottie.loadAnimation({\n\t\t\t\t\tloop: this.loop,\n\t\t\t\t\tautoplay: this.autoPlay,\n\t\t\t\t\t// 动画json的本地数据\n\t\t\t\t\tanimationData: this.data,\n\t\t\t\t\t//远程动画。一定要把json格式的文件放到服务器中，并且注意域名是合法的\n\t\t\t\t\tpath: this.src,\n\t\t\t\t\trendererSettings: {\n\t\t\t\t\t\tcontext:this.context,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tthis.player.addEventListener('data_ready',(val)=>{ //当动画的所有部分都已加载时\n\t\t\t\t\tthis.$emit('dataReady', val)\n\t\t\t\t})\n\t\t\t\tthis.player.addEventListener('data_failed',(val)=>{ //当部分动画无法加载时\n\t\t\t\t\tthis.$emit('dataFailed', val)\n\t\t\t\t})\n\t\t\t\tthis.player.onComplete = (val) => { //动画播放完成触发\n\t\t\t\t\t// uni.__f__('log','at uni_modules/c-lottie/components/c-lottie/c-lottie.vue:184','动画播放完成触发',val);\n\t\t\t\t\tthis.$emit('Complete', val)\n\t\t\t\t}\n\t\t\t\tthis.player.onLoopComplete = (val) => { //当前循环播放完成触发\n\t\t\t\t\t// uni.__f__('log','at uni_modules/c-lottie/components/c-lottie/c-lottie.vue:188','当前循环播放完成触发',val);\n\t\t\t\t\tthis.$emit('LoopComplete', val)\n\t\t\t\t}\n\t\t\t\tif (this.isOnChange) {\n\t\t\t\t\tthis.player.onEnterFrame = (val) => { //播放动画的时候触发\n\t\t\t\t\t\t// uni.__f__('log','at uni_modules/c-lottie/components/c-lottie/c-lottie.vue:193','播放动画的时候触发',val);\n\t\t\t\t\t\tthis.$emit('EnterFrame', val)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.player.onSegmentStart = (val) => { //开始播放一个动画片段的时候触发\n\t\t\t\t\t// uni.__f__('log','at uni_modules/c-lottie/components/c-lottie/c-lottie.vue:198','开始播放一个动画片段的时候触发',val);\n\t\t\t\t\tthis.$emit('SegmentStart', val)\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tcallPlayer(val) {\n\t\t\t\tif (!val.name) return;\n\t\t\t\tlet {name,args} = val\n\t\t\t\t// uni.__f__('log','at uni_modules/c-lottie/components/c-lottie/c-lottie.vue:206',name, args);\n\t\t\t\tif (Array.isArray(args)) {\n\t\t\t\t\tthis.player[name](...args)\n\t\t\t\t} else {\n\t\t\t\t\tthis.player[name](args)\n\t\t\t\t}\n\t\t\t},\n\n\n\n\n\n\n\n\t\t},\n\t\tmounted() {\n\n\t\t\tthis.render()\n\n\t\t},\n\t\tbeforeDestroy() {\n\t\t\t// 组件卸载销毁实例\n\t\t\tthis.call('destroy')\n\t\t}\n\n\t}\n</script>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<style lang=\"scss\" scoped>\n\t.c-lottie {\n\t\t// width: v-bind(width);\n\t\t// height: v-bind(height);\n\n\n\n\n\n\n\n\n\n\t\t.canvas {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t}\n\t}\n</style>","import Component from '/Users/ghw/Documents/waibao/yanshilu_ui/uni_modules/c-lottie/components/c-lottie/c-lottie.vue'\nwx.createComponent(Component)"],"names":["defineComponent","uuid","uni","lottie"],"mappings":"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"}