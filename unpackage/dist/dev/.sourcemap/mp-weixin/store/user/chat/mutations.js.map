{"version":3,"file":"mutations.js","sources":["store/user/chat/mutations.js"],"sourcesContent":["/**\n * chat模块的mutations\n * @module store/user/chat/mutations\n */\n\nexport default {\n        // 会话相关\n        SET_CURRENT_SESSION(state, session) {\n            state.currentSession = {...state.currentSession, ...session}\n          },\n          \n          ADD_OR_UPDATE_SESSION(state, session) {\n            if (!state.sessions.byId[session.sessionId]) {\n              state.sessions.allIds.unshift(session.sessionId)\n            }\n            state.sessions.byId[session.sessionId] = {...state.sessions.byId[session.sessionId], ...session}\n          },\n          \n          REMOVE_SESSION(state, sessionId) {\n            delete state.sessions.byId[sessionId]\n            state.sessions.allIds = state.sessions.allIds.filter(id => id !== sessionId)\n          },\n          \n          UPDATE_SESSION_LAST_MESSAGE(state, {sessionId, message}) {\n            const session = state.sessions.byId[sessionId]\n            if (session) {\n              session.lastMessage = message\n              session.lastMessageTime = message.time\n            }\n          },\n          \n          // 消息相关\n          ADD_MESSAGE(state, {sessionId, message}) {\n            if (!state.messages.bySessionId[sessionId]) {\n              state.messages.bySessionId[sessionId] = {\n                hasMore: true,\n                isLoading: false,\n                list: []\n              }\n            }\n            state.messages.bySessionId[sessionId].list.push(message)\n          },\n          \n          PREPEND_MESSAGES(state, {sessionId, messages}) {\n            if (!state.messages.bySessionId[sessionId]) {\n              state.messages.bySessionId[sessionId] = {\n                hasMore: true,\n                isLoading: false,\n                list: []\n              }\n            }\n            state.messages.bySessionId[sessionId].list.unshift(...messages)\n          },\n          \n          UPDATE_MESSAGE_STATUS(state, {sessionId, messageId, status}) {\n            const messages = state.messages.bySessionId[sessionId]?.list\n            if (messages) {\n              const msg = messages.find(m => m.id === messageId)\n              if (msg) msg.status = status\n            }\n          },\n          \n          // 用户信息相关\n          UPDATE_USER_INFO(state, userInfo) {\n            state.userInfos[userInfo.userId] = {...state.userInfos[userInfo.userId], ...userInfo}\n          },\n          \n          // 连接状态相关\n          SET_CONNECTION_STATUS(state, {isConnected, isConnecting}) {\n            state.connection.isConnected = isConnected\n            state.connection.isConnecting = isConnecting\n            if (isConnected) {\n              state.connection.lastError = null\n              state.connection.reconnectCount = 0\n            }\n          },\n          \n          SET_CONNECTION_ERROR(state, error) {\n            state.connection.lastError = error\n            state.connection.reconnectCount++\n          }\n}; \n"],"names":[],"mappings":";AAKA,MAAe,YAAA;AAAA;AAAA,EAEP,oBAAoB,OAAO,SAAS;AAChC,UAAM,iBAAiB,EAAC,GAAG,MAAM,gBAAgB,GAAG,QAAO;AAAA,EAC5D;AAAA,EAED,sBAAsB,OAAO,SAAS;AACpC,QAAI,CAAC,MAAM,SAAS,KAAK,QAAQ,SAAS,GAAG;AAC3C,YAAM,SAAS,OAAO,QAAQ,QAAQ,SAAS;AAAA,IAChD;AACD,UAAM,SAAS,KAAK,QAAQ,SAAS,IAAI,EAAC,GAAG,MAAM,SAAS,KAAK,QAAQ,SAAS,GAAG,GAAG,QAAO;AAAA,EAChG;AAAA,EAED,eAAe,OAAO,WAAW;AAC/B,WAAO,MAAM,SAAS,KAAK,SAAS;AACpC,UAAM,SAAS,SAAS,MAAM,SAAS,OAAO,OAAO,QAAM,OAAO,SAAS;AAAA,EAC5E;AAAA,EAED,4BAA4B,OAAO,EAAC,WAAW,QAAO,GAAG;AACvD,UAAM,UAAU,MAAM,SAAS,KAAK,SAAS;AAC7C,QAAI,SAAS;AACX,cAAQ,cAAc;AACtB,cAAQ,kBAAkB,QAAQ;AAAA,IACnC;AAAA,EACF;AAAA;AAAA,EAGD,YAAY,OAAO,EAAC,WAAW,QAAO,GAAG;AACvC,QAAI,CAAC,MAAM,SAAS,YAAY,SAAS,GAAG;AAC1C,YAAM,SAAS,YAAY,SAAS,IAAI;AAAA,QACtC,SAAS;AAAA,QACT,WAAW;AAAA,QACX,MAAM,CAAE;AAAA,MACT;AAAA,IACF;AACD,UAAM,SAAS,YAAY,SAAS,EAAE,KAAK,KAAK,OAAO;AAAA,EACxD;AAAA,EAED,iBAAiB,OAAO,EAAC,WAAW,SAAQ,GAAG;AAC7C,QAAI,CAAC,MAAM,SAAS,YAAY,SAAS,GAAG;AAC1C,YAAM,SAAS,YAAY,SAAS,IAAI;AAAA,QACtC,SAAS;AAAA,QACT,WAAW;AAAA,QACX,MAAM,CAAE;AAAA,MACT;AAAA,IACF;AACD,UAAM,SAAS,YAAY,SAAS,EAAE,KAAK,QAAQ,GAAG,QAAQ;AAAA,EAC/D;AAAA,EAED,sBAAsB,OAAO,EAAC,WAAW,WAAW,OAAM,GAAG;;AAC3D,UAAM,YAAW,WAAM,SAAS,YAAY,SAAS,MAApC,mBAAuC;AACxD,QAAI,UAAU;AACZ,YAAM,MAAM,SAAS,KAAK,OAAK,EAAE,OAAO,SAAS;AACjD,UAAI;AAAK,YAAI,SAAS;AAAA,IACvB;AAAA,EACF;AAAA;AAAA,EAGD,iBAAiB,OAAO,UAAU;AAChC,UAAM,UAAU,SAAS,MAAM,IAAI,EAAC,GAAG,MAAM,UAAU,SAAS,MAAM,GAAG,GAAG,SAAQ;AAAA,EACrF;AAAA;AAAA,EAGD,sBAAsB,OAAO,EAAC,aAAa,aAAY,GAAG;AACxD,UAAM,WAAW,cAAc;AAC/B,UAAM,WAAW,eAAe;AAChC,QAAI,aAAa;AACf,YAAM,WAAW,YAAY;AAC7B,YAAM,WAAW,iBAAiB;AAAA,IACnC;AAAA,EACF;AAAA,EAED,qBAAqB,OAAO,OAAO;AACjC,UAAM,WAAW,YAAY;AAC7B,UAAM,WAAW;AAAA,EAClB;AACX;;"}