{"version":3,"file":"settings.js","sources":["pagesMine/settings/settings.vue","pagesMine/settings/settings.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"background-image\">\n    <image\n      class=\"background-image-img\"\n      src=\"/static/image/bgPicture/background1.png\"\n      mode=\"aspectFill\" alt=\"背景图\"\n    />\n  </view>\n  <view class=\"background-image\">\n    <image\n      class=\"background-image-img\"\n      src=\"/static/image/bgPicture/background.png\"\n      mode=\"aspectFill\" alt=\"背景图\"\n    />\n  </view>\n  <Header :title=\"'设置'\" @back=\"handleBack\"/>\n  <view class=\"container\">\n    <view class=\"settings-list\">\n      <!-- 切换身份 -->\n      <view class=\"settings-item\" @click=\"handleSwitchRole\">\n        <view class=\"icon-circle-info\">\n          <image src=\"/pagesMine/static/settings/exchange.png\" class=\"icon\" mode=\"widthFix\" />\n        </view>\n        <text class=\"settings-text\">切换身份（当前：{{isTeacher ? '老师' : '学生'}}）</text>\n      </view>\n      <!--修改个人信息-->\n      <view class=\"settings-item\" @click=\"handleModifyInfo\">\n        <view class=\"icon-circle-info\">\n          <image src=\"/pagesMine/static/settings/exchange.png\" class=\"icon\" mode=\"widthFix\" />\n        </view>\n        <text class=\"settings-text\">修改个人信息</text>\n      </view>\n      <!-- 退出登录 -->\n      <view class=\"settings-item\" @click=\"handleLogout\" v-if=\"isLoggedIn\">\n        <view class=\"icon-circle-info\">\n          <image src=\"/pagesMine/static/settings/logout.png\" class=\"icon\" mode=\"widthFix\" />\n        </view>\n        <text class=\"settings-text\">退出登录</text>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script lang=\"uts\">\n/**\n * @description 设置页面\n */\nimport { Navigator } from '@/router/Router.js';\nimport store from '@/store';\nimport { mapGetters } from 'vuex';\nimport Header from '@/components/navigationTitleBar/header';\n\nexport default {\n  components: {\n    Header\n  },\n  data() {\n    return {\n      isLoggedIn: false, \n      switching: false,  // 角色切换中状态\n    }\n  },\n  computed: {\n    ...mapGetters({\n      isTeacher: 'user/baseInfo/isTeacher',\n      userRole: 'user/baseInfo/userRole',\n      profile: 'user/baseInfo/profile'\n    }),\n    isStudent() {\n      return !this.isTeacher;\n    }\n  },\n  onLoad() {\n    // 检查登录状态\n    this.isLoggedIn = store.getters['user/baseInfo/id'] !== '';\n  },\n  methods: {\n    handleBack() {\n      Navigator.toMine();\n    },\n    // 直接调用store的dispatch方法，替代mapActions\n    /**\n     * @description 处理修改个人信息\n     */\n    handleModifyInfo() {\n      Navigator.toModify();\n    },\n    /**\n     * @description 处理切换身份\n     */\n    handleSwitchRole() {\n      if (this.switching) return;\n      \n      // 确定切换的目标角色\n      const newRole = this.isTeacher ? 'student' : 'teacher';\n      \n      uni.showModal({\n        title: '切换身份',\n        content: `确定要切换到${newRole === 'teacher' ? '老师' : '学生'}模式吗？`,\n        success: async (res) => {\n          if (res.confirm) {\n            try {\n              this.switching = true;\n              \n              // 使用store.dispatch调用action\n              await store.dispatch('user/baseInfo/updateRole', newRole);\n              \n              uni.showToast({\n                title: newRole === 'teacher' ? '已切换为老师模式' : '已切换为学生模式',\n                icon: 'none'\n              });\n              \n              // 返回到\"我的\"页面并刷新\n              setTimeout(() => {\n                Navigator.reLaunch('/pagesMine/mine/mine_common');\n              }, 1500);\n            } catch (error) {\n              uni.__f__('error','at pagesMine/settings/settings.vue:118','切换角色失败:', error);\n              uni.showToast({\n                title: '切换角色失败',\n                icon: 'none'\n              });\n            } finally {\n              this.switching = false;\n            }\n          }\n        }\n      });\n    },\n    /**\n     * @description 处理退出登录\n     */\n    handleLogout() {\n      uni.showModal({\n        title: '提示',\n        content: '确定要退出登录吗？',\n        success: async (res) => {\n          if (res.confirm) {\n            try {\n              // 使用store.dispatch调用登出action\n              await store.dispatch('user/baseInfo/logout');\n              \n              uni.showToast({\n                title: '已退出登录',\n                icon: 'success'\n              });\n              \n              // 增加延迟确保数据清除\n              setTimeout(() => {\n                // 返回到\"我的\"页面\n                Navigator.reLaunch('/pagesMine/mine/mine_common');\n              }, 1500);\n            } catch (error) {\n              uni.__f__('error','at pagesMine/settings/settings.vue:154','退出登录时出错:', error);\n              uni.showToast({\n                title: '退出登录时出错',\n                icon: 'none'\n              });\n            }\n          }\n        }\n      });\n    }\n  }\n}\n</script>\n\n<style>\n.container {\n  display: flex;\n  flex-direction: column;\n  min-height: 100%;\n  background-color: transparent;\n  padding-top: 20rpx;\n}\n.background-image {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  z-index: 0;\n  pointer-events: none;\n}\n.background-image-img {\n  width: 100vw;\n  height: 100vh;\n  object-fit: cover;\n  display: block;\n}\n.settings-list {\n  width: 100%;\n}\n\n.settings-item {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: flex-start;\n  padding: 20rpx 0;\n  border-bottom: 2rpx solid rgba(217, 217, 217, 1);\n  min-height: 100rpx;\n}\n\n.icon-circle-info {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: center;\n}\n\n\n.icon {\n  width: 60rpx;\n  margin-left: 60rpx;\n}\n\n\n\n.settings-text {\n  height: 25rpx;\n  width: 100%;\n  font-size: 25rpx;\n  color: rgba(0, 0, 0, 1);\n  font-family: PingFang SC;\n  font-weight: 500;\n  line-height: 100%;\n  letter-spacing: -1.1rpx;\n  margin-left: 30rpx;\n}\n</style>","import MiniProgramPage from '/Users/ghw/Documents/waibao/yanshilu_ui/pagesMine/settings/settings.vue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","mapGetters","store","Navigator","uni","__awaiter"],"mappings":";;;;;AAkDA,MAAO,SAAY,MAAA;AAEnB,MAAA,YAAeA,8BAAA;AAAA,EACb,YAAY;AAAA,IACV;AAAA,EACD;AAAA,EACD,OAAI;AACF,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,WAAW;AAAA;AAAA;EAEd;AAAA,EACD,UAAQ,OAAA,OAAA,OAAA,OAAA,IACHC,cAAAA,WAAW,IAAA,cAAA;AAAA,IACZ,WAAW;AAAA,IACX,UAAU;AAAA,IACV,SAAS;AAAA,EACV,CAAA,CAAA,CAAC,KACF,YAAS;AACP,WAAO,CAAC,KAAK;AAAA,EACf,GACD;AAAA,EACD,SAAM;AAEJ,SAAK,aAAaC,YAAK,MAAC,QAAQ,kBAAkB,MAAM;AAAA,EACzD;AAAA,EACD,SAAS;AAAA,IACP,aAAU;AACRC,oBAAS,UAAC,OAAM;AAAA,IACjB;AAAA;AAAA;AAAA;AAAA;AAAA,IAKD,mBAAgB;AACdA,oBAAS,UAAC,SAAQ;AAAA,IACnB;AAAA;AAAA;AAAA;AAAA,IAID,mBAAgB;AACd,UAAI,KAAK;AAAW,eAAM;AAG1B,YAAM,UAAU,KAAK,YAAY,YAAY;AAE7CC,0BAAI,UAAU,IAAA,cAAA;AAAA,QACZ,OAAO;AAAA,QACP,SAAS,SAAS,YAAY,YAAY,OAAO,IAAI;AAAA,QACrD,SAAS,CAAO,QAAG;AAAA,iBAAAC,cAAAA,UAAA,MAAA,QAAA,QAAA,aAAA;AACjB,gBAAI,IAAI,SAAS;AACf,kBAAI;AACF,qBAAK,YAAY;AAGjB,sBAAMH,kBAAM,SAAS,4BAA4B,OAAO;AAExDE,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO,YAAY,YAAY,aAAa;AAAA,kBAC5C,MAAM;AAAA,gBACP,CAAA;AAGD,2BAAW,MAAA;AACTD,0CAAU,SAAS,6BAA6B;AAAA,gBACjD,GAAE,IAAI;AAAA,cACP,SAAO,OAAO;AACdC,8BAAG,MAAC,MAAM,SAAQ,0CAAyC,WAAW,KAAK;AAC3EA,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO;AAAA,kBACP,MAAM;AAAA,gBACP,CAAA;AAAA,cACH,UAAU;AACR,qBAAK,YAAY;AAAA,cACnB;AAAA,YACF;AAAA,UACF,CAAA;AAAA,QAAA;AAAA,MACD,CAAA,CAAA;AAAA,IACF;AAAA;AAAA;AAAA;AAAA,IAID,eAAY;AACVA,0BAAI,UAAU,IAAA,cAAA;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAO,QAAG;AAAA,iBAAAC,cAAAA,UAAA,MAAA,QAAA,QAAA,aAAA;AACjB,gBAAI,IAAI,SAAS;AACf,kBAAI;AAEF,sBAAMH,YAAK,MAAC,SAAS,sBAAsB;AAE3CE,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO;AAAA,kBACP,MAAM;AAAA,gBACP,CAAA;AAGD,2BAAW,MAAA;AAETD,0CAAU,SAAS,6BAA6B;AAAA,gBACjD,GAAE,IAAI;AAAA,cACP,SAAO,OAAO;AACdC,8BAAG,MAAC,MAAM,SAAQ,0CAAyC,YAAY,KAAK;AAC5EA,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO;AAAA,kBACP,MAAM;AAAA,gBACP,CAAA;AAAA,cACH;AAAA,YACF;AAAA,UACF,CAAA;AAAA,QAAA;AAAA,MACD,CAAA,CAAA;AAAA,IACH;AAAA,EACF;CACF;;;;;;;;;;;;;;;;;;;;;;;;;ACnKA,GAAG,WAAW,eAAe;"}